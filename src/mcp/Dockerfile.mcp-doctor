# MCP Doctor Server - Docker Image
# Meta-MCP that diagnoses and fixes other MCP servers

FROM node:20-alpine

# Install diagnostic tools
RUN apk add --no-cache \
    bash \
    curl \
    jq \
    && rm -rf /var/cache/apk/*

# Set working directory
WORKDIR /app

# Create package.json for dependencies
RUN echo '{"name":"mcp-doctor-server","version":"1.0.0","type":"module","dependencies":{"@modelcontextprotocol/sdk":"^1.0.4"}}' > package.json

# Install dependencies
RUN npm install --omit=dev

# Copy the MCP server script
COPY mcp-doctor-server.js .
RUN chmod +x mcp-doctor-server.js

# Set environment variables
ENV NODE_ENV=production

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD node -e "process.exit(0)"

# Run the MCP Doctor server
CMD ["node", "mcp-doctor-server.js"]
