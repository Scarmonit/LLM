version: '3.8'

name: mcp-ultra-production

networks:
  mcp-ultra:
    driver: bridge

volumes:
  omnipotent-ultra-data:
  a2a-ultra-data:

services:
  # ============================================================================
  # OMNIPOTENT MCP v4.0 - ULTRA OPTIMIZED
  # ============================================================================
  omnipotent-ultra:
    build:
      context: ./omnipotent-mcp
      dockerfile_inline: |
        FROM python:3.11-slim
        WORKDIR /app

        RUN pip install --no-cache-dir mcp psutil httpx beautifulsoup4 lxml aiofiles

        COPY server_ultra_optimized.py /app/server.py

        CMD ["python", "-u", "server.py"]

    image: omnipotent-mcp:ultra-v4
    container_name: omnipotent-mcp-ultra
    restart: unless-stopped
    networks:
      - mcp-ultra
    volumes:
      - omnipotent-ultra-data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONOPTIMIZE=2
      - LOG_LEVEL=INFO
      - MAX_FILE_SIZE=104857600
      - MAX_RESPONSE_SIZE=10485760
      - CACHE_TTL=5
      - HTTP_POOL_SIZE=20
      - HTTP_TIMEOUT=30
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # A2A UNIFIED MCP v4.0 - ULTRA OPTIMIZED WITH REAL FUNCTIONALITY
  # ============================================================================
  a2a-ultra:
    build:
      context: ./unified-intelligent-mcp
      dockerfile_inline: |
        FROM python:3.11-slim
        WORKDIR /app

        RUN pip install --no-cache-dir mcp httpx beautifulsoup4 lxml aiofiles

        COPY server_ultra_optimized.py /app/server.py

        CMD ["python", "-u", "server.py"]

    image: a2a-unified-mcp:ultra-v4
    container_name: a2a-unified-mcp-ultra
    restart: unless-stopped
    networks:
      - mcp-ultra
    volumes:
      - a2a-ultra-data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONOPTIMIZE=2
      - A2A_DATA_DIR=/app/data
      - LOG_LEVEL=INFO
      - CACHE_TTL=3600
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
